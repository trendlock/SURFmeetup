<!DOCTYPE html>
<html>
  <head>
    <title>Turning Turnbull and Shorten into data</title>
    <meta charset="utf-8">
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/default-fonts.css" rel="stylesheet" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Turning Turnbull and Shorten into data
## Aidan Morrison &amp; Ross Ireland
### April 2018

---





![](images/shorten_media.png)


---

![](images/turnbull_media.png)


---

class:  middle

# Motivation
### - Accessing and cleaning data in the real world
### - Wholistic, public, potential interest, SEARCHABLE, find events
### - Endless analysis possible, just a start, eg "Driving Debate" or "Sentiment"

---

class: middle

# Source

### - Inspecting media pages (transcipts, media releases and opinion pieces)
### - Engineering a method to systimaticall crawl the site
### - Understanding the typical layout of a media page

---
class: middle

# Scrape

### - rvest (web scraping html pages)
### - cloudyr (a open source project with many clients to cloud computing services)
- awspack
- aws.s3
- googleCloudStorageR


.footnote[[hadley/rvest](github.com/hadley/rvest)  -  [cloudyr](github.com/cloudyr)]

---
class: middle



```r
library(rvest)

h &lt;- read_html("http://www.billshorten.com.au/transcripts")
```





Extracting anchors/links on the page:

```r
anchors &lt;- html_nodes(h, "a")
```

An example:

`&lt;a href=\"/transcript_doorstop_canberra_monday_27_november_2017\"&gt;
TRANSCRIPT - DOORSTOP - CANBERRA - MONDAY, 27 NOVEMBER 2017 &lt;/a&gt;`

---
class: middle

`&lt;a href=\"/transcript_doorstop_canberra_monday_27_november_2017\"&gt;
TRANSCRIPT - DOORSTOP - CANBERRA - MONDAY, 27 NOVEMBER 2017 &lt;/a&gt;`

Separate the text and the `href`:

```r
html_text(anchors)
```
"TRANSCRIPT - DOORSTOP - CANBERRA - MONDAY, 27 NOVEMBER 2017"

```r
html_attr(anchors, "href")
```
"/transcript_doorstop_canberra_monday_27_november_2017"

---

class: middle

# Managing errors

Safely catch errors and respond to them:


```r
h &lt;- read_html("http://www.billshorten.com.au/transcript")
```
`Error in open.connection(x, "rb") : HTTP error 404.`


---

class: middle


```r
safe_read_html &lt;- purrr::safely(read_html)

h &lt;- safe_read_html("http://www.billshorten.com.au/transcript")

h
```

```
## $result
## NULL
## 
## $error
## &lt;simpleError in open.connection(x, "rb"): HTTP error 404.&gt;
```

```r
h &lt;- safe_read_html("http://www.billshorten.com.au/transcripts")

h
```

```
## $result
## {xml_document}
## &lt;html lang="en"&gt;
## [1] &lt;head&gt;\n&lt;meta http-equiv="Content-Type" content="text ...
## [2] &lt;body&gt;\n&lt;div id="ZN_4YktvKMlWgWYIWF"&gt;&lt;!--DO NOT REMOV ...
## 
## $error
## NULL
```



---
class: middle

# Processing/Cleaning

```html
div class="headline"&gt;
  &lt;h2&gt;TRANSCRIPT - DOORSTOP - MELBOURNE - FRIDAY, 26 JANUARY 2018&lt;/h2&gt;
&lt;/div&gt;

&lt;div id="content"&gt;

  &lt;div id="intro" class="intro"&gt;
    &lt;div class="content"&gt;
      &lt;p&gt;&lt;strong&gt;E&amp;amp;OE TRANSCRIPT&lt;br&gt;&lt;/strong&gt;&lt;strong&gt;DOORSTOP&lt;br&gt;&lt;/strong&gt;&lt;strong&gt;MELBOURNE&lt;br&gt;&lt;/strong&gt;&lt;strong&gt;FRIDAY, 26 JANUARY 2018&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;SUBJECT/S: &lt;em&gt;Australian of the Year, trade, Australia Day, republic, cost of living. &lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;BILL SHORTEN, LEADER OF THE OPPOSITION:&lt;/strong&gt; Good morning everybody. I’m fortunate to be in the western Suburbs of Melbourne, welcoming 150 new Australian citizens.&lt;/p&gt;
&lt;p&gt;I’d like to congratulate Australian of the Year, Michelle Simmons. Her win is a win for her and her personal hard work, but it’s also a win for science, and it’s &lt;/p&gt;
&lt;p&gt;Happy to take any questions that people might have.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;JOURNALIST:&lt;/strong&gt; Is there any hope now that the US can re-join the TPP deal?&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;SHORTEN:&lt;/strong&gt; I think first of all we need to see if this new trade agreement stacks up. Let me be very clear, this is not the old Trans Pacific Partnership which included the United States. I was right when I said that Donald Trump had walked away from that, and he hasn’t come back. But this new arrangement, whilst it’s much &lt;/p&gt;
&lt;p&gt;If it stacks up, Labor will give it the tick, if it doesn’t stack up then we’re not going to give it the tick. What we need to do is always watch out for the interests of working and middle-class Aussies, &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;JOURNALIST:&lt;/strong&gt; Just back on Australia Day, we’ve already seen a few far right rallyists go to citizenship ceremonies and they’ll be holding an event in St Kilda today, what do you have to say to those people?&lt;/p&gt;
```

---

#### Aidans ratio method
#### boilerpipeR

.footnote[[mannau/boilerpipeR](github.com/mannau/boilerpipeR)]
---

## Comparing methods

---

class: middle


```r
library(boilerpipeR)

DefaultExtractor()
ArticleExtractor()
KeepEverythingExtractor()
LargestContentExtractor()
NumWordsRulesExtractor()
```



---

## tidytext

- Tokenize a string
- Splitting a speech into sentences, phrases and words


```r
library(tidytext)


text_df &lt;- tibble(
  text = "We have to remember that Australia is part of a big integrated global economy."
)
```


.footnote[[juliasilge/tidytext](github.com/juliasilge/tidytext)]
---

class: middle


```r
unnest_tokens(text_df, word, text)
```

```
## # A tibble: 14 x 1
##    word      
##    &lt;chr&gt;     
##  1 we        
##  2 have      
##  3 to        
##  4 remember  
##  5 that      
##  6 australia 
##  7 is        
##  8 part      
##  9 of        
## 10 a         
## 11 big       
## 12 integrated
## 13 global    
## 14 economy
```

---

class: middle


```r
unnest_tokens(text_df, word, text, "ngrams", n = 3)
```

```
## # A tibble: 12 x 1
##    word                     
##    &lt;chr&gt;                    
##  1 we have to               
##  2 have to remember         
##  3 to remember that         
##  4 remember that australia  
##  5 that australia is        
##  6 australia is part        
##  7 is part of               
##  8 part of a                
##  9 of a big                 
## 10 a big integrated         
## 11 big integrated global    
## 12 integrated global economy
```

---

## Using Natural Language Processing (NLP)

- Named Entity Recognition (NER)
- people, places, organisations, currency, dates, times

"It's great to be in Burnie at the University of Tasmania Campus here with my colleague Senator Anne Urquhart."

`NLP` and `openNLP`


```r
person_ann &lt;- Maxent_Entity_Annotator(kind = "person")
location_ann &lt;- Maxent_Entity_Annotator(kind = "location")
organization_ann &lt;- Maxent_Entity_Annotator(kind = "organization")

people &lt;- entities(sent, kind = "person")
places &lt;- entities(bio_doc, kind = "location")
orgs &lt;- entities(bio_doc, kind = "organization")
```

---

class: middle

"It's great to be in Burnie at the University of Tasmania Campus here with my colleague Senator Anne Urquhart."


```r
people
```

```
## [1] "Anne Urquhart"
```

```r
places
```

```
## [1] "Burnie"
```

```r
orgs
```

```
## [1] "University of Tasmania"
```

---
class: middle

## Sentiment Analysis

- `RSentiment` and `tidytext`
- Scoring sentences on a spectrum of negativity and positivity

.footnote[[RSentiment](http://cran.r-project.org/package=RSentiment)  -  [juliasilge/tidytext](http://github.com/juliasilge/tidytext)]

---
class: middle


```r
library(RSentiment)
```

"The real problem here is that the people of Australia don't like the Government because they're so hopelessly out of touch."


```r
sentence_chr &lt;- "The real problem here is that the people of Australia don't like the Government because they're so hopelessly out of touch."
calculate_sentiment(sentence_chr)
```

```
## [1] "Very Negative"
```

"It's fabulous to be back in Queensland - coming into the home straight ready to hit the line strong."

```r
sentence_chr &lt;- "It's fabulous to be back in Queensland - coming into the home straight ready to hit the line strong."
calculate_sentiment(sentence_chr)
```

```
## [1] "Very Positive"
```


---

class: middle

### Identifying whose words are who's

![](images/lignin.png)

---

# String Manipulation


```r
library(dplyr)
library(stringr)
```





```r
df_speech
```

```
## # A tibble: 5 x 1
##   sent                                                     
##   &lt;chr&gt;                                                    
## 1 JOURNALIST: Would you like to see more companies who are…
## 2 PRIME MINISTER: Visy has the opportunity to do so becaus…
## 3 Is that the right term?                                  
## 4 ANTHONY PRATT: Lignin, yeah.                             
## 5 PRIME MINISTER: Lignin which is the by-product of the pa…
```

.footnote[[tidyverse/stringr](https://github.com/tidyverse/stringr)]

---

class: middle


```r
df_speech &lt;- mutate(df_speech, who = case_when(
  str_detect(sent, "JOURNALIST:") ~ "Jrn",
  str_detect(sent, "SHORTEN:") ~ "BS",
  str_detect(sent, "TURNBULL|PRIME MINISTER:") ~ "MT",
  str_detect(sent, "[[:upper:]]:") ~ "Other"
  )) %&gt;% 
  tidyr::fill(who)

df_speech
```

```
## # A tibble: 5 x 2
##   sent                                                who  
##   &lt;chr&gt;                                               &lt;chr&gt;
## 1 JOURNALIST: Would you like to see more companies w… Jrn  
## 2 PRIME MINISTER: Visy has the opportunity to do so … MT   
## 3 Is that the right term?                             MT   
## 4 ANTHONY PRATT: Lignin, yeah.                        Other
## 5 PRIME MINISTER: Lignin which is the by-product of … MT
```


---
class: middle


# A useable data set!


- ~2500 speeches
- going back 4 years

- Features including:

---
class: middle

# Visualisation and Exloration Tools

### - shiny (simple interactive web apps) 
### - plotly (interactive visualisatons) 
### - leaflet (interactive maps)

.footnote[
[rstudio/shiny](http://github.com/rstudio/shiny) - [ropensci/plotly](http://github.com/ropensci/plotly) - [rstudio/leaflet](http://github.com/rstudio/leaflet)]
---

class: middle

# Analysis

### - Who drives debate?
### - Language and Location

### - Sentiment
### - Favouraite Phrases

---

class: middle

# Location Analysis



```r
ggmap::geocode("Bega", source = "dsk")
```

```
## Information from URL : http://www.datasciencetoolkit.org/maps/api/geocode/json?address=Bega&amp;sensor=false
```

```
## # A tibble: 1 x 2
##     lon   lat
##   &lt;dbl&gt; &lt;dbl&gt;
## 1  150. -36.7
```

.footnote[[dkahle/ggmap](https://github.com/dkahle/ggmap)]

---

class: middle, center

# Australia

![](images/map.png)

---

class: middle, center

# Melbourne

![](images/melb_0.png)

---

class: middle, center

# Melbourne

![](images/melb_1.png)


---

class: middle, center

# Melbourne

![](images/melb_2.png)

---

class: middle, center

# Sentence Length by Location 

![](images/map sent loc.png)

---

class: middle, center

# Sentence Length by Location 

![](SURFmeetup_files/figure-html/unnamed-chunk-27-1.png)&lt;!-- --&gt;



---
    </textarea>
<script src="libs/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function() {
  var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})();</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
  }
});
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
